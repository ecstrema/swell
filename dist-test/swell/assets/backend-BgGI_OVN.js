import{i as e}from"./core-oPxbWvCg.js";var t,n=0,r=null;function i(){return(r===null||r.byteLength===0)&&(r=new Uint8Array(t.memory.buffer)),r}var a=typeof TextEncoder<`u`?new TextEncoder(`utf-8`):{encode:()=>{throw Error(`TextEncoder not available`)}},o=typeof a.encodeInto==`function`?function(e,t){return a.encodeInto(e,t)}:function(e,t){let n=a.encode(e);return t.set(n),{read:e.length,written:n.length}};function s(e,t,r){if(r===void 0){let r=a.encode(e),o=t(r.length,1)>>>0;return i().subarray(o,o+r.length).set(r),n=r.length,o}let s=e.length,c=t(s,1)>>>0,l=i(),u=0;for(;u<s;u++){let t=e.charCodeAt(u);if(t>127)break;l[c+u]=t}if(u!==s){u!==0&&(e=e.slice(u)),c=r(c,s,s=u+e.length*3,1)>>>0;let t=i().subarray(c+u,c+s),n=o(e,t);u+=n.written,c=r(c,s,u,1)>>>0}return n=u,c}var c=null;function l(){return(c===null||c.buffer.detached===!0||c.buffer.detached===void 0&&c.buffer!==t.memory.buffer)&&(c=new DataView(t.memory.buffer)),c}var u=typeof TextDecoder<`u`?new TextDecoder(`utf-8`,{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error(`TextDecoder not available`)}};typeof TextDecoder<`u`&&u.decode();function d(e,t){return e>>>=0,u.decode(i().subarray(e,e+t))}function f(e){let n=t.__wbindgen_export_2.get(e);return t.__externref_table_dealloc(e),n}function p(e){let r=s(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=n,a=t.get_hierarchy_wasm(r,i);if(a[2])throw f(a[1]);return f(a[0])}function m(e,n){e>>>=0;let r=l(),i=[];for(let a=e;a<e+4*n;a+=4)i.push(t.__wbindgen_export_2.get(r.getUint32(a,!0)));return t.__externref_drop_slice(e,n),i}function h(){let e=t.get_files();var n=m(e[0],e[1]).slice();return t.__wbindgen_free(e[0],e[1]*4,4),n}function g(e,r,i,a){let o=s(e,t.__wbindgen_malloc,t.__wbindgen_realloc),c=n,l=t.get_signal_changes_wasm(o,c,r,i,a);if(l[2])throw f(l[1]);return f(l[0])}function _(e,t){let r=t(e.length*1,1)>>>0;return i().set(e,r/1),n=e.length,r}function v(e,r){let i,a;try{let l=s(e,t.__wbindgen_malloc,t.__wbindgen_realloc),u=n,p=_(r,t.__wbindgen_malloc),m=n,h=t.add_file_bytes(l,u,p,m);var o=h[0],c=h[1];if(h[3])throw o=0,c=0,f(h[2]);return i=o,a=c,d(o,c)}finally{t.__wbindgen_free(i,a,1)}}function y(e){let r=s(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=n;t.remove_file(r,i)}async function b(e,t){if(typeof Response==`function`&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming==`function`)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if(e.headers.get(`Content-Type`)!=`application/wasm`)console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function x(){let e={};return e.wbg={},e.wbg.__wbg_String_8f0eb39a4a4c2f66=function(e,r){let i=s(String(r),t.__wbindgen_malloc,t.__wbindgen_realloc),a=n;l().setInt32(e+4,a,!0),l().setInt32(e+0,i,!0)},e.wbg.__wbg_new_405e22f390576ce2=function(){return{}},e.wbg.__wbg_new_78feb108b6472713=function(){return[]},e.wbg.__wbg_set_37837023f3d740e8=function(e,t,n){e[t>>>0]=n},e.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,n){e[t]=n},e.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},e.wbg.__wbindgen_error_new=function(e,t){return Error(d(e,t))},e.wbg.__wbindgen_init_externref_table=function(){let e=t.__wbindgen_export_2,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},e.wbg.__wbindgen_number_new=function(e){return e},e.wbg.__wbindgen_string_new=function(e,t){return d(e,t)},e.wbg.__wbindgen_throw=function(e,t){throw Error(d(e,t))},e}function S(e,n){return t=e.exports,C.__wbindgen_wasm_module=n,c=null,r=null,t.__wbindgen_start(),t}async function C(e){if(t!==void 0)return t;e!==void 0&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn(`using deprecated parameters for the initialization function; pass a single object instead`)),e===void 0&&(e=new URL(`/swell/assets/backend_bg-D0aIPUrH.wasm`,``+import.meta.url));let n=x();(typeof e==`string`||typeof Request==`function`&&e instanceof Request||typeof URL==`function`&&e instanceof URL)&&(e=fetch(e));let{instance:r,module:i}=await b(await e,n);return S(r,i)}var w=C;async function T(t={}){return typeof t==`object`&&Object.freeze(t),await e(`plugin:dialog|open`,{options:t})}var E=`swell-file-session`,D=1,O=`files`;function k(){return new Promise((e,t)=>{let n=indexedDB.open(E,D);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(O)||t.createObjectStore(O,{keyPath:`name`})}})}async function A(e,t){if(!N)try{let n=await k(),r=n.transaction([O],`readwrite`),i=r.objectStore(O),a={name:e,data:t,timestamp:Date.now()};i.put(a),await new Promise((e,t)=>{r.oncomplete=()=>e(),r.onerror=()=>t(r.error)}),n.close()}catch(e){console.error(`Failed to save file to session:`,e)}}async function j(e){if(!N)try{let t=await k(),n=t.transaction([O],`readwrite`);n.objectStore(O).delete(e),await new Promise((e,t)=>{n.oncomplete=()=>e(),n.onerror=()=>t(n.error)}),t.close()}catch(e){console.error(`Failed to remove file from session:`,e)}}async function M(){if(N)return[];try{let e=await k(),t=e.transaction([O],`readonly`).objectStore(O).getAll(),n=await new Promise((e,n)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)});return e.close(),n}catch(e){return console.error(`Failed to get session files:`,e),[]}}const N=!!window.__TAURI_INTERNALS__;N||await w();async function P(){if(N)try{return await T({multiple:!1,directory:!1,filters:[{name:`Waveform Files`,extensions:[`vcd`,`fst`,`ghw`]}]})}catch(e){return console.error(`Failed to open file dialog:`,e),null}else return new Promise(e=>{let t=document.createElement(`input`);t.type=`file`,t.accept=`.vcd,.fst,.ghw`,t.onchange=t=>{e(t.target.files?.[0])},t.click()})}const F=async t=>{if(N)return await e(`add_file_command`,{path:t});if(t instanceof File){let e=await t.arrayBuffer(),n=new Uint8Array(e),r=v(t.name,n);return await A(t.name,n),r}throw Error(`Expected File object in Web mode`)},I=async t=>{if(N)return await e(`add_file_command`,{path:`examples/${t}`});let n=`/swell/examples/${t}`,r=await fetch(n);if(!r.ok)throw Error(`Failed to load example file: ${t}`);let i=await r.arrayBuffer(),a=new Uint8Array(i),o=v(t,a);return await A(t,a),o},L=async()=>N?await e(`get_files`):h(),R=async t=>{if(N)return await e(`remove_file`,{path:t});let n=y(t);return await j(t),n},z=async t=>N?await e(`get_hierarchy`,{filename:t}):p(t),B=async(t,n,r,i)=>N?await e(`get_signal_changes`,{filename:t,signalId:n,start:r,end:i}):g(t,n,BigInt(r),BigInt(i)),V=async()=>{if(!N)try{let e=await M();console.log(`Restoring ${e.length} files from session`);for(let t of e)try{await v(t.name,t.data)}catch(e){console.error(`Failed to restore file ${t.name}:`,e)}}catch(e){console.error(`Failed to restore session:`,e)}};export{N as a,R as c,B as i,V as l,L as n,I as o,z as r,P as s,F as t};